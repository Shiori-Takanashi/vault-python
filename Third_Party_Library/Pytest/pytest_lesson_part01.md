---
title: 
keyword: 
created: 2025-08-06 15:33
modified: 2025-08-06 15:33
vault: Python
catergory: Language
language: Python
area: Third_Library
identify:  
type: Lesson
tole: Part
order: 
---


---

## 第01章：pytestとは何か

Pythonでのユニットテストフレームワークとして、標準ライブラリの `unittest` が広く使われていますが、それに代わる柔軟かつ強力なツールとして注目されているのが `pytest` です。この章では、`pytest` の特徴と利点について解説します。

### `unittest` との違いと利点

`unittest` はクラスベースのテスト記述が基本ですが、`pytest` は関数ベースでより簡潔にテストを書くことができます。例えば、セットアップやアサーションがシンプルで、読みやすさ・保守性に優れています。

| 機能       | unittest                 | pytest           |
| -------- | ------------------------ | ---------------- |
| テストの記述形式 | クラスベース                   | 関数ベース            |
| アサーション構文 | `self.assertEqual(a, b)` | `assert a == b`  |
| 拡張性      | 独自記述が必要                  | プラグイン豊富・自動発見機能あり |

### シンプルな記述スタイル

`pytest` の魅力の一つは、Python本来の文法に近い形でテストを書ける点です。例えば、以下のように非常に直感的にテストを書くことができます。

```python
def add(x, y):
    return x + y

def test_add():
    assert add(2, 3) == 5
```

このように、テスト関数名を `test_` で始めれば、自動的に検出・実行されます。

### インストールと基本実行方法

`pytest` は以下のコマンドで簡単にインストールできます。

```bash
pip install pytest
```

インストール後、テストを実行するには、プロジェクトルートやテストファイルのあるディレクトリで次のように実行します。

```bash
pytest
```

これにより、`test_*.py` という名前のファイル内の `test_` で始まる関数が自動的に見つけられ、実行されます。エラーや失敗した箇所も詳細に出力されるため、トラブルシューティングも容易です。

---

## 第02章：テスト関数の基本形

`pytest` を使ったテストは、特別なクラスや継承を必要とせず、シンプルに関数として定義できます。この章では、テスト関数の基本形とその書き方を学びます。

### `test_` から始まる関数定義

`pytest` では、関数名が `test_` で始まることで、それがテスト関数として認識されます。ファイル名も同様に `test_` で始めることで、自動的に収集対象となります。

```python
def test_is_even():
    assert 4 % 2 == 0
```

上記のように、単純な関数であっても `test_` で始まればテストとして機能します。

### `assert` 文による検証

Pythonの組み込みキーワード `assert` を使って、期待される値と実際の結果を比較します。`assert` が失敗すると `AssertionError` が発生し、その行のテストは失敗と判定されます。

```python
def test_add():
    result = 2 + 3
    assert result == 5
```

この簡潔さが `pytest` の最大の強みの一つです。

### テスト結果の読み方

テスト実行後には、各テスト関数の成否が表示されます。例えば、次のような出力になります。

```
collected 2 items

test_sample.py ..                                    [100%]

================== 2 passed in 0.02s ==================
```

* `.`：成功したテスト
* `F`：失敗したテスト
* `E`：エラーで実行不能だったテスト

出力にはエラーのトレースバックや失敗理由も表示されるため、デバッグが容易になります。

---



## 第03章：pytestコマンド入門

### `pytest` の基本オプション

`pytest` には多数の実行オプションがあります。まずは代表的なものを確認しましょう。

* `-v`：詳細モード（verbose）。各テストの関数名と結果が表示されます。
* `-q`：簡潔モード（quiet）。出力が簡略化され、成功・失敗だけを表示します。
* `--maxfail=n`：テスト失敗が `n` 件に達した時点で中断します。

```bash
pytest -v --maxfail=2
```

### `-v`・`-q`・`--maxfail` の活用

実行時のオプションを活用することで、状況に応じた出力制御が可能です。

```bash
pytest -v                  # 詳細表示で実行
pytest -q                  # 出力を簡潔に
pytest --maxfail=1 -v      # 最初の1件失敗で即中断
```

### ファイル／関数／マークの絞り込み実行

特定のテストファイル、関数だけを実行するには、次のように指定します。

```bash
pytest test_sample.py                       # ファイル単位で実行
pytest test_sample.py::test_add             # 関数単位で実行
```

### テストマーク（`@pytest.mark`）による分類と実行

`pytest.mark` を使うと、テストに任意のラベルを付けて分類・選別実行ができます。

#### マークの定義と使用例

```python
import pytest

@pytest.mark.slow
def test_heavy_computation():
    ...
```

このように定義されたマーク付きのテストだけを実行するには、次のように `-m` オプションを使います。

```bash
pytest -m slow
```

#### マークの組み合わせ

論理演算で複雑な条件指定も可能です：

```bash
pytest -m "slow and not network"
pytest -m "smoke or regression"
```

#### カスタムマークの登録（警告回避）

デフォルト以外のマークを使う場合、`pytest.ini` で定義しておくと警告を避けられます。

```ini
# pytest.ini
[pytest]
markers =
    slow: 長時間かかるテスト
    network: ネットワーク依存のテスト
```

こうすることで、チームでの共有や CI での自動実行時に混乱を防げます。

---


