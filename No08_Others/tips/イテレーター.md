
> ## イテレーターの基本

---

> ### イテレーターとは

* **一つずつ値を取り出せるオブジェクト**
* `__iter__()` と `__next__()` の2つのメソッドを持つ
* `for` ループの裏側では `next()` 関数が使われている

---

> ### イテラブルとの違い

| 用語     | 特徴                           | 主な例                             |
| ------ | ---------------------------- | ------------------------------- |
| イテラブル  | `__iter__()`を持つ              | `list`, `dict`, `str`など         |
| イテレーター | `__next__()`と`__iter__()`を持つ | `map()`, `filter()`, ファイルオブジェクト |

```python
lst = [1, 2, 3]          # イテラブル
it = iter(lst)           # イテレーターに変換

next(it)  # 1
next(it)  # 2
next(it)  # 3
next(it)  # StopIterationが発生
```

---

> ### イテレーターの作成

```python
class CountUpTo:
    def __init__(self, max):
        self.max = max
        self.current = 1

    def __iter__(self):
        return self

    def __next__(self):
        if self.current > self.max:
            raise StopIteration
        else:
            val = self.current
            self.current += 1
            return val

counter = CountUpTo(3)

for num in counter:
    print(num)  # 1, 2, 3
```

---

> ### `iter()` と `next()` の基本

```python
nums = [10, 20, 30]
it = iter(nums)

print(next(it))  # 10
print(next(it))  # 20
print(next(it))  # 30
print(next(it))  # StopIteration発生
```

---

> ### 無限イテレーターの例（危険）

```python
class InfiniteOnes:
    def __iter__(self):
        return self

    def __next__(self):
        return 1

# for x in InfiniteOnes(): print(x)  # 無限ループ
```

---

> ### 応用：ジェネレーターとの関係

* `yield` を使った関数はイテレーターになる
* 状態を保持しながら値を順に返す

```python
def countdown(n):
    while n > 0:
        yield n
        n -= 1

for num in countdown(3):  # 3, 2, 1
    print(num)
```

---
