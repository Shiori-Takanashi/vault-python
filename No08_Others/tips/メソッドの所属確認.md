
# 🔍 Pythonメソッドの所属を確認する方法

---

## ✅ 目的

> メソッドが「どのクラス」「どのモジュール」「どのインスタンス」に属しているかを確認したい。

---

## ✅ 1. type() で所属インスタンスの型を確認

```python
type(obj)
```

例：

```python
s = "hello"
print(type(s))  # <class 'str'>
```

→ `s.upper()` のようなメソッドは `str` 型に属していることが分かる。

---

## ✅ 2. dir() で属性一覧を確認

```python
dir(obj)
```

* そのオブジェクトが持つすべての属性（メソッド含む）をリスト表示。

```python
print(dir(s))
# 'capitalize', 'casefold', 'center', 'count', 'encode', ...
```

---

## ✅ 3. help() で所属モジュール・クラスを確認

```python
help(obj.method)
```

または：

```python
help("str.upper")
```

出力例：

```
Help on built-in function upper:

upper(self, /)
    Return a copy of the string converted to uppercase.
```

→ `upper` は `str` 型に属する。

---

## ✅ 4. inspect モジュールで詳細確認

```python
import inspect

print(inspect.getmodule(obj.method))     # 所属モジュール
print(inspect.getclasstree([type(obj)])) # 継承関係
print(inspect.getfile(obj.method))       # 定義ファイル（ソース）
```

> 標準モジュールや自作モジュールに対して強力。

---

# ❗ メソッド単体からは「所属クラス」を特定できない理由

---

## ✅ 理由1：Pythonは関数を第一級オブジェクトとして扱う

* メソッドは関数として切り出せるため、**所属情報を失った状態で独立可能**。

```python
class A:
    def f(self): pass

func = A.f  # ← この時点ではどのクラスに属するか記録されない
```

---

## ✅ 理由2：関数オブジェクトに「所属クラス」の情報は保持されていない

```python
print(A.f.__qualname__)  # 'A.f' ← 見かけ上の名前空間だけ
print(A.f.__module__)    # '__main__' ← モジュールは分かるがクラスは無理
```

> `__qualname__` を文字列処理して推測することはできるが、**構文的保証はない**

---

## ✅ 例外的に分かる場合

| 状況               | 所属クラスの特定可否                             | 説明           |
| ---------------- | -------------------------------------- | ------------ |
| クラスオブジェクト上から取得   | ✅ `A.f` など                             | クラス名が明示されている |
| インスタンスメソッド       | △ `obj.method.__self__.__class__` で推測可 |              |
| 関数単体 (`f = A.f`) | ❌ 不可能（情報が失われている）                       |              |

---

## 🧪 例：情報が失われた関数オブジェクト

```python
class C:
    def greet(self): pass

f = C.greet

print(f.__qualname__)   # 'C.greet' ← 名前文字列でしか分からない
print(f.__self__)       # AttributeError ← バウンドされていない
```

---

## 🧠 結論

* メソッドは「どこに属していたか」を明確に記録していない
* 所属クラスを知るには、**クラスオブジェクトやインスタンスとの関連づけが必要**
* 単体で渡された関数からクラスを知るのは、**Pythonの仕様上困難**

---

## ✅ 補足：推測したいときは

```python
def get_qualname_owner(func):
    """'Class.method' という __qualname__ から 'Class' を推測"""
    try:
        return func.__qualname__.split(".")[0]
    except AttributeError:
        return None
```

> ただしこれは安全でも汎用的でもありません。

---

### 統一見解：

> **関数（メソッド）単体では所属クラスを構文的に特定することはできない**。
> Pythonが動的型付けであり、関数が独立可能なオブジェクトであることに起因する。

---

## ✅ まとめ：用途別の確認法

| 確認内容       | 方法                            | 備考        |
| ---------- | ----------------------------- | --------- |
| 所属クラス      | `type(obj)` / `obj.__class__` | インスタンスベース |
| 所属モジュール    | `inspect.getmodule()`         | 関数・クラスレベル |
| 定義場所       | `inspect.getfile()`           | ファイルパスが出る |
| 継承元確認      | `inspect.getclasstree()`      | 継承階層も確認可能 |
| 持ってるメソッド一覧 | `dir()` / `help()`            | 一覧確認用     |

---

