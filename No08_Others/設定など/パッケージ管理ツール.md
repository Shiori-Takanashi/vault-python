

## 📦 Python主要パッケージ管理ツールの棲み分け

---

### 🧭 全体図（役割で分類）

| 分類               | ツール                                       | 主な役割                                         |
| ---------------- | ----------------------------------------- | -------------------------------------------- |
| インストーラ（Install）  | ✅ `pip`                                   | パッケージをインストールする（PyPIやローカル）                    |
| ビルド（Build）       | ✅ `setuptools` / `flit` / `poetry`        | パッケージを構築・配布形式（wheelなど）に変換                    |
| 依存管理（Dependency） | `pip-tools`, `poetry`, `hatch`            | `requirements.txt` や `pyproject.toml` の生成と管理 |
| パッケージ公開          | `twine`, `flit publish`, `poetry publish` | PyPIにアップロードする                                |

---

## 🔧 各ツールの概要

### ✅ pip（インストール）

* Python公式の標準インストーラ
* `pip install xxx`, `pip install -r requirements.txt` で使用
* **常に使用される土台ツール**

---

### ✅ setuptools（ビルドバックエンド）

* 最も基本的なビルドツール（旧：`setup.py`、新：`pyproject.toml`対応）
* `pip install .` 時に呼び出される
* 他ツールが使わなくなってきても、**pipからは未だに必要とされる**

---

### ✅ poetry（ビルド + 依存管理 + 仮想環境管理）

* モダンな統合ツール（`pyproject.toml`前提）
* `poetry add`, `poetry install`, `poetry build`, `poetry publish`
* `setuptools` を使わず、`poetry-core` をビルドバックエンドにする

---

### ✅ pip-tools（依存ロック特化）

* `requirements.in` → `requirements.txt` へロックファイル生成
* `pip-compile`, `pip-sync`
* `pip` にロック管理機能を補完する中間的ツール

---

### ✅ flit（最軽量パッケージビルド）

* `pyproject.toml` にだけ対応。極小ライブラリ向け
* `setuptools` や `setup.py` を使用しない簡易派
* 依存管理・仮想環境管理機能は無い

---

### ✅ build（ビルドフロントエンド）

* `python -m build` で wheel や sdist を生成
* `pyproject.toml` に従ってバックエンド（setuptoolsなど）を呼ぶだけ
* CIや配布自動化に使用

---

### ✅ twine（PyPIアップロード専用）

* `.whl` や `.tar.gz` を PyPI にアップロードするCLI
* `poetry` や `flit` は内部でこれと同等の機能を持つ

---

## 🧱 典型的構成例（pip/setuptoolsベース）

```
pip install .
↓
pyproject.toml（build-system セクション）を読み
↓
setuptools を使ってビルド
↓
pip が最終的にインストール
```

---

## 🧪 poetryベース構成例

```
poetry install
↓
poetry.lock に従って依存解決
↓
仮想環境を自動構築
↓
pyproject.toml で管理されたパッケージを構築
```

---

## ✅ 結論：選択指針

| 用途              | 推奨構成                             |
| --------------- | -------------------------------- |
| 小規模スクリプト        | pip + requirements.txt           |
| チーム開発（再現性重視）    | pip + pip-tools                  |
| ライブラリ開発         | poetry または setuptools（PEP 621準拠） |
| 最小構成でPyPI公開     | flit 単独 or setuptools            |
| 高度な依存・仮想環境管理も統一 | poetry 一択                        |

---

## 🔚 備考

* **`pip` は常に中心にある**（他ツールも最終的にpipが使うことが多い）
* **`pyproject.toml` が新しい中心軸**で、setup.pyやsetup.cfgは時代遅れになりつつある
* **ツールの併用**（例：pip + pip-tools）は現場によって必要

---
